<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Estudio de TransmisiÃ³n en Vivo</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  margin: 0;
  font-family: Arial, Helvetica, sans-serif;
  background: #0b1623;
  color: #fff;
}
header {
  background: #081b2d;
  padding: 20px;
  text-align: center;
}
.container {
  max-width: 1100px;
  margin: auto;
  padding: 20px;
}
.panel {
  display: grid;
  grid-template-columns: 2fr 1fr;
  gap: 20px;
}
video {
  width: 100%;
  background: black;
  border-radius: 12px;
}
.controls {
  background: #10263f;
  padding: 20px;
  border-radius: 12px;
}
button {
  width: 100%;
  padding: 12px;
  margin-bottom: 10px;
  border-radius: 6px;
  border: none;
  cursor: pointer;
}
.btn-camera { background: #1abc9c; }
.btn-screen { background: #3498db; }
.btn-start  { background: #e74c3c; }
.btn-stop   { background: #7f8c8d; }
.status {
  margin-top: 10px;
  color: #00ff9c;
}
</style>
</head>

<body>

<header>
  <h1>ðŸŽ¥ Estudio de TransmisiÃ³n en Vivo</h1>
  <p>Software de transmisiÃ³n web</p>
</header>

<div class="container">
  <div class="panel">

    <video id="preview" autoplay muted playsinline></video>

    <div class="controls">
      <input id="streamKey" placeholder="Pega la clave de transmisiÃ³n">
      <button class="btn-camera" onclick="startCamera()">ðŸ“· Activar CÃ¡mara</button>
      <button class="btn-screen" onclick="shareScreen()">ðŸ–¥ Compartir Pantalla</button>
      <button class="btn-start" onclick="startStream()">ðŸ”´ Iniciar TransmisiÃ³n</button>
      <button class="btn-stop" onclick="stopStream()">â›” Detener</button>
      <div class="status" id="status">Estado: detenido</div>
    </div>

  </div>
</div>

<script>
let stream = null;
let pc = null;

const preview = document.getElementById("preview");
const statusEl = document.getElementById("status");

function setStatus(text) {
  statusEl.innerText = "Estado: " + text;
}

async function startCamera() {
  stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });
  preview.srcObject = stream;
  setStatus("CÃ¡mara activa");
}

async function shareScreen() {
  stream = await navigator.mediaDevices.getDisplayMedia({ video: true, audio: true });
  preview.srcObject = stream;
  setStatus("Pantalla compartida");
}

async function startStream() {
  if (!stream) {
    alert("Activa cÃ¡mara o pantalla primero");
    return;
  }

  pc = new RTCPeerConnection();

  pc.onicecandidate = e => {
    if (e.candidate === null) {
      fetch("http://localhost:8889/live/whep", {
        method: "POST",
        headers: { "Content-Type": "application/sdp" },
        body: pc.localDescription.sdp
      });
    }
  };

  stream.getTracks().forEach(track => pc.addTrack(track, stream));

  const offer = await pc.createOffer();
  await pc.setLocalDescription(offer);

  setStatus("ðŸ“¡ Enviando a MediaMTX");
}

function stopStream() {
  if (pc) pc.close();
  if (stream) stream.getTracks().forEach(t => t.stop());
  preview.srcObject = null;
  setStatus("Detenido");
}
</script>

</body>
</html>

